### üß™ JAR RATIO API TEST - REST CLIENT FILE
### Base URL: http://localhost:3000
### S·ª≠ d·ª•ng v·ªõi VS Code REST Client Extension

###############################################
# 1. SETUP - LOGIN & GET TOKENS
###############################################

### 1.1. Login - Nh√¢n vi√™n (55555)
# @name login_55555
POST http://localhost:3000/api/auth/login
Content-Type: application/json

{
  "username": "55555",
  "password": "55555"
}

### L∆∞u token
@token_55555 = {{login_55555.response.body.data.access_token}}

###

### 1.2. Login - Gi√°m ƒë·ªëc (0018)
# @name login_0018
POST http://localhost:3000/api/auth/login
Content-Type: application/json

{
  "username": "0018",
  "password": "0018"
}

### L∆∞u token
@token_0018 = {{login_0018.response.body.data.access_token}}

###

### 1.3. Login - Ch·ªß t·ªãch (0025)
# @name login_0025
POST http://localhost:3000/api/auth/login
Content-Type: application/json

{
  "username": "0025",
  "password": "0025"
}

### L∆∞u token
@token_0025 = {{login_0025.response.body.data.access_token}}

###

### 1.4. Login - Ch·ªß t·ªãch HƒêQT (44444)
# @name login_44444
POST http://localhost:3000/api/auth/login
Content-Type: application/json

{
  "username": "44444",
  "password": "44444"
}

### L∆∞u token
@token_44444 = {{login_44444.response.body.data.access_token}}

###

###############################################
# 2. L·∫§Y DANH S√ÅCH JAR
###############################################

### 2.1. L·∫•y danh s√°ch Jar
# @name get_jars
GET http://localhost:3000/api/jars?page=1&limit=20
Authorization: Bearer {{token_55555}}

### L∆∞u jar IDs (thay b·∫±ng jar_id th·ª±c t·∫ø t·ª´ response)
@jar_id_1 = paste_jar_id_1_here
@jar_id_2 = paste_jar_id_2_here
@jar_id_3 = paste_jar_id_3_here

###

###############################################
# 3. CRUD T·ª∂ L·ªÜ L·ªå
###############################################

### 3.1. ‚úÖ T·∫°o T·ª∑ L·ªá L·ªç H·ª£p L·ªá (T·ªïng ratio = 100%)
# @name create_jar_ratio
POST http://localhost:3000/api/jar-ratios
Authorization: Bearer {{token_55555}}
Content-Type: application/json

{
  "month": 12,
  "year": 2025,
  "note": "Test t·ª∑ l·ªá l·ªç th√°ng 12/2025 - Flow ho√†n ch·ªânh",
  "details": [
    {
      "jar_id": "{{jar_id_1}}",
      "ratio": 40,
      "planned_revenue": 100000000,
      "minimum_cost": 30000000
    },
    {
      "jar_id": "{{jar_id_2}}",
      "ratio": 35,
      "planned_revenue": 80000000,
      "minimum_cost": 25000000
    },
    {
      "jar_id": "{{jar_id_3}}",
      "ratio": 25,
      "planned_revenue": 60000000,
      "minimum_cost": 15000000
    }
  ]
}

### L∆∞u jar_ratio_id
@jar_ratio_id = {{create_jar_ratio.response.body.data.id}}

###

### 3.2. ‚ùå T·∫°o T·ª∑ L·ªá L·ªç - T·ªïng Ratio ‚â† 100% (SHOULD FAIL)
POST http://localhost:3000/api/jar-ratios
Authorization: Bearer {{token_55555}}
Content-Type: application/json

{
  "month": 11,
  "year": 2025,
  "note": "Test validation - t·ªïng ratio kh√¥ng ƒë√∫ng",
  "details": [
    {
      "jar_id": "{{jar_id_1}}",
      "ratio": 40,
      "planned_revenue": 100000000,
      "minimum_cost": 30000000
    },
    {
      "jar_id": "{{jar_id_2}}",
      "ratio": 35,
      "planned_revenue": 80000000,
      "minimum_cost": 25000000
    }
  ]
}

###

### 3.3. ‚ùå T·∫°o T·ª∑ L·ªá L·ªç - Tr√πng Th√°ng/NƒÉm (SHOULD FAIL)
POST http://localhost:3000/api/jar-ratios
Authorization: Bearer {{token_55555}}
Content-Type: application/json

{
  "month": 12,
  "year": 2025,
  "note": "Test duplicate month/year",
  "details": [
    {
      "jar_id": "{{jar_id_1}}",
      "ratio": 50,
      "planned_revenue": 100000000,
      "minimum_cost": 30000000
    },
    {
      "jar_id": "{{jar_id_2}}",
      "ratio": 50,
      "planned_revenue": 100000000,
      "minimum_cost": 30000000
    }
  ]
}

###

### 3.4. ‚ùå T·∫°o T·ª∑ L·ªá L·ªç - Tr√πng jar_id (SHOULD FAIL)
POST http://localhost:3000/api/jar-ratios
Authorization: Bearer {{token_55555}}
Content-Type: application/json

{
  "month": 10,
  "year": 2025,
  "note": "Test duplicate jar_id",
  "details": [
    {
      "jar_id": "{{jar_id_1}}",
      "ratio": 50,
      "planned_revenue": 100000000,
      "minimum_cost": 30000000
    },
    {
      "jar_id": "{{jar_id_1}}",
      "ratio": 50,
      "planned_revenue": 100000000,
      "minimum_cost": 30000000
    }
  ]
}

###

### 3.5. üìñ Xem Danh S√°ch T·ª∑ L·ªá L·ªç (Pagination)
GET http://localhost:3000/api/jar-ratios?page=1&limit=10
Authorization: Bearer {{token_55555}}

###

### 3.6. üìñ Xem Chi Ti·∫øt T·ª∑ L·ªá L·ªç
GET http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}
Authorization: Bearer {{token_55555}}

###

### 3.7. üìñ Xem Danh S√°ch Mobile
GET http://localhost:3000/api/jar-ratios/mobile?page=1&limit=10
Authorization: Bearer {{token_55555}}

###

### 3.8. üìñ L·∫•y Danh S√°ch Ng∆∞·ªùi T·∫°o
GET http://localhost:3000/api/jar-ratios/creators
Authorization: Bearer {{token_55555}}

###

### 3.9. ‚úèÔ∏è C·∫≠p Nh·∫≠t T·ª∑ L·ªá L·ªç (Status = waiting_director)
PUT http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}
Authorization: Bearer {{token_55555}}
Content-Type: application/json

{
  "month": 12,
  "year": 2025,
  "note": "Updated - Test t·ª∑ l·ªá l·ªç th√°ng 12/2025",
  "details": [
    {
      "jar_id": "{{jar_id_1}}",
      "ratio": 45,
      "planned_revenue": 120000000,
      "minimum_cost": 35000000
    },
    {
      "jar_id": "{{jar_id_2}}",
      "ratio": 30,
      "planned_revenue": 70000000,
      "minimum_cost": 20000000
    },
    {
      "jar_id": "{{jar_id_3}}",
      "ratio": 25,
      "planned_revenue": 65000000,
      "minimum_cost": 18000000
    }
  ]
}

###

###############################################
# 4. QUY TR√åNH DUY·ªÜT 3 C·∫§P
###############################################

### 4.1. ‚úÖ C·∫§P 1: Gi√°m ƒê·ªëc Duy·ªát (0018)
# waiting_director ‚Üí waiting_president
PUT http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}/approve
Authorization: Bearer {{token_0018}}
Content-Type: application/json

{
  "status": "approved",
  "note": "Gi√°m ƒë·ªëc ƒë√£ duy·ªát - OK"
}

###

### 4.2. ‚ùå C·∫§P 1: Gi√°m ƒê·ªëc T·ª´ Ch·ªëi (Alternative)
# waiting_director ‚Üí rejected
PUT http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}/approve
Authorization: Bearer {{token_0018}}
Content-Type: application/json

{
  "status": "rejected",
  "note": "Gi√°m ƒë·ªëc t·ª´ ch·ªëi - C·∫ßn ƒëi·ªÅu ch·ªânh l·∫°i t·ª∑ l·ªá"
}

###

### 4.3. ‚úÖ C·∫§P 2: Ch·ªß T·ªãch Duy·ªát (0025)
# waiting_president ‚Üí waiting_board_chairman
PUT http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}/approve
Authorization: Bearer {{token_0025}}
Content-Type: application/json

{
  "status": "approved",
  "note": "Ch·ªß t·ªãch ƒë√£ duy·ªát - OK"
}

###

### 4.4. ‚ùå C·∫§P 2: Ch·ªß T·ªãch T·ª´ Ch·ªëi (Alternative)
# waiting_president ‚Üí rejected
PUT http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}/approve
Authorization: Bearer {{token_0025}}
Content-Type: application/json

{
  "status": "rejected",
  "note": "Ch·ªß t·ªãch t·ª´ ch·ªëi - Kh√¥ng ph√π h·ª£p"
}

###

### 4.5. ‚úÖ C·∫§P 3: Ch·ªß T·ªãch HƒêQT Duy·ªát (44444) - FINAL
# waiting_board_chairman ‚Üí approved
PUT http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}/approve
Authorization: Bearer {{token_44444}}
Content-Type: application/json

{
  "status": "approved",
  "note": "Ch·ªß t·ªãch HƒêQT ƒë√£ duy·ªát - Ho√†n t·∫•t"
}

###

### 4.6. ‚ùå C·∫§P 3: Ch·ªß T·ªãch HƒêQT T·ª´ Ch·ªëi (Alternative)
# waiting_board_chairman ‚Üí rejected
PUT http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}/approve
Authorization: Bearer {{token_44444}}
Content-Type: application/json

{
  "status": "rejected",
  "note": "Ch·ªß t·ªãch HƒêQT t·ª´ ch·ªëi - C·∫ßn xem x√©t l·∫°i"
}

###

###############################################
# 5. B√ÅO C√ÅO T·ª∂ L·ªÜ L·ªå
###############################################

### 5.1. üìä L·∫•y B√°o C√°o T·ª∑ L·ªá L·ªç (Sau khi approved)
GET http://localhost:3000/api/jar-ratios/report?month=12&year=2025
Authorization: Bearer {{token_55555}}

###

### 5.2. ‚ùå B√°o C√°o - Th√°ng Kh√¥ng C√≥ T·ª∑ L·ªá L·ªç (SHOULD FAIL)
GET http://localhost:3000/api/jar-ratios/report?month=6&year=2030
Authorization: Bearer {{token_55555}}

###

### 5.3. ‚ùå Validation - Month = 13 (SHOULD FAIL)
GET http://localhost:3000/api/jar-ratios/report?month=13&year=2025
Authorization: Bearer {{token_55555}}

###

### 5.4. ‚ùå Validation - Month = 0 (SHOULD FAIL)
GET http://localhost:3000/api/jar-ratios/report?month=0&year=2025
Authorization: Bearer {{token_55555}}

###

### 5.5. ‚ùå Validation - Thi·∫øu Month (SHOULD FAIL)
GET http://localhost:3000/api/jar-ratios/report?year=2025
Authorization: Bearer {{token_55555}}

###

### 5.6. ‚ùå Validation - Thi·∫øu Year (SHOULD FAIL)
GET http://localhost:3000/api/jar-ratios/report?month=12
Authorization: Bearer {{token_55555}}

###

###############################################
# 6. COMMENT & T∆Ø∆†NG T√ÅC
###############################################

### 6.1. üí¨ Th√™m Comment
# @name add_comment
POST http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}/comments
Authorization: Bearer {{token_55555}}
Content-Type: application/json

{
  "content": "ƒê√¢y l√† comment test cho t·ª∑ l·ªá l·ªç n√†y"
}

### L∆∞u comment_id
@comment_id = {{add_comment.response.body.data.id}}

###

### 6.2. üìñ Xem Danh S√°ch Comment
GET http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}/comments?page=1&limit=10
Authorization: Bearer {{token_55555}}

###

### 6.3. ‚úèÔ∏è C·∫≠p Nh·∫≠t Comment
PUT http://localhost:3000/api/jar-ratios/comments/{{comment_id}}
Authorization: Bearer {{token_55555}}
Content-Type: application/json

{
  "content": "Comment ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t"
}

###

### 6.4. üóëÔ∏è X√≥a Comment
DELETE http://localhost:3000/api/jar-ratios/comments/{{comment_id}}
Authorization: Bearer {{token_55555}}

###

###############################################
# 7. EXPORT EXCEL
###############################################

### 7.1. üì• Xu·∫•t Excel Danh S√°ch T·ª∑ L·ªá L·ªç
GET http://localhost:3000/api/jar-ratios/export?from_month=01-2025&to_month=12-2025
Authorization: Bearer {{token_55555}}

###

###############################################
# 8. TEST CASES ƒê·∫∂C BI·ªÜT - EDGE CASES
###############################################

### 8.1. ‚ùå C·∫≠p Nh·∫≠t Khi Status ‚â† waiting_director (SHOULD FAIL)
PUT http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}
Authorization: Bearer {{token_55555}}
Content-Type: application/json

{
  "month": 12,
  "year": 2025,
  "note": "Try to update approved jar ratio",
  "details": [
    {
      "jar_id": "{{jar_id_1}}",
      "ratio": 50,
      "planned_revenue": 100000000,
      "minimum_cost": 30000000
    },
    {
      "jar_id": "{{jar_id_2}}",
      "ratio": 50,
      "planned_revenue": 100000000,
      "minimum_cost": 30000000
    }
  ]
}

###

### 8.2. ‚ùå X√≥a Jar Ratio Kh√¥ng T·ªìn T·∫°i (SHOULD FAIL)
DELETE http://localhost:3000/api/jar-ratios/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{token_55555}}

###

### 8.3. ‚ùå Xem Chi Ti·∫øt Jar Ratio Kh√¥ng T·ªìn T·∫°i (SHOULD FAIL)
GET http://localhost:3000/api/jar-ratios/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{token_55555}}

###

### 8.4. ‚ùå Duy·ªát V·ªõi User Kh√¥ng C√≥ Quy·ªÅn (SHOULD FAIL)
PUT http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}/approve
Authorization: Bearer {{token_55555}}
Content-Type: application/json

{
  "status": "approved",
  "note": "Try to approve with wrong user"
}

###

###############################################
# 9. X√ìA T·ª∂ L·ªÜ L·ªå (CU·ªêI C√ôNG)
###############################################

### 9.1. üóëÔ∏è X√≥a T·ª∑ L·ªá L·ªç (Soft Delete)
# ‚ö†Ô∏è C·∫¢NH B√ÅO: Ch·ªâ ch·∫°y sau khi ho√†n th√†nh t·∫•t c·∫£ test!
DELETE http://localhost:3000/api/jar-ratios/{{jar_ratio_id}}
Authorization: Bearer {{token_55555}}

###

###############################################
# üéØ H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG
###############################################

# 1. C√†i ƒë·∫∑t "REST Client" extension trong VS Code
# 2. Ch·∫°y c√°c request theo th·ª© t·ª±:
#    a. Section 1: Login t·∫•t c·∫£ users
#    b. Section 2: L·∫•y jar_id v√† thay v√†o bi·∫øn @jar_id_1, @jar_id_2, @jar_id_3
#    c. Section 3: Test CRUD operations
#    d. Section 4: Test approval workflow (3 c·∫•p)
#    e. Section 5: Test report (sau khi approved)
#    f. Section 6: Test comment
#    g. Section 7: Test export
#    h. Section 8: Test edge cases
#    i. Section 9: X√≥a (cu·ªëi c√πng)
#
# 3. Click "Send Request" ·ªü tr√™n m·ªói request ƒë·ªÉ ch·∫°y
# 4. Bi·∫øn s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c l∆∞u v√† s·ª≠ d·ª•ng trong c√°c request sau
# 5. C√°c request c√≥ nh√£n (SHOULD FAIL) ph·∫£i tr·∫£ v·ªÅ l·ªói

###
