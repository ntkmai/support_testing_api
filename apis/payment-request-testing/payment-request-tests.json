{
  "requests": [
    {
      "name": "Login",
      "method": "POST",
      "endpoint": "/api/auth/login",
      "description": "## Đăng nhập hệ thống\nĐăng nhập với các tài khoản theo vai trò khác nhau trong quy trình duyệt phiếu\n\n## Các vai trò\n- Người tạo phiếu: 55555/55555\n- Trưởng bộ phận: 55555/55555\n- Kế toán hàng hóa: 0091/0091\n- Kế toán tài sản: 0025/0001\n- Kế toán thuế: 44444/44444\n- Kế toán thanh toán: 11111/11111\n- TBP KTTT: 22222/22222\n- Kế toán trưởng: 33333/33333",
      "headers": {
        "Content-Type": "application/json"
      },
      "body": {
        "username": "55555",
        "password": "55555"
      },
      "templates": [
        {
          "name": "Người tạo phiếu (55555)",
          "description": "Login người tạo phiếu - Bước 0",
          "body": {
            "username": "55555",
            "password": "55555"
          }
        },
        {
          "name": "Trưởng bộ phận (55555)",
          "description": "Login trưởng bộ phận - Bước 1",
          "body": {
            "username": "55555",
            "password": "55555"
          }
        },
        {
          "name": "Kế toán tài sản (0025)",
          "description": "Login KT tài sản - Bước 2 (nếu lọ tài sản)",
          "body": {
            "username": "0025",
            "password": "0001"
          }
        },
        {
          "name": "Kế toán hàng hóa (0091)",
          "description": "Login KT hàng hóa - Bước 2 (nếu lọ hàng hóa)",
          "body": {
            "username": "0091",
            "password": "0091"
          }
        },
        {
          "name": "Kế toán thuế (44444)",
          "description": "Login KT thuế - Bước 2 (nếu lọ khác) hoặc Bước 3",
          "body": {
            "username": "44444",
            "password": "44444"
          }
        },
        {
          "name": "Kế toán thanh toán (11111)",
          "description": "Login KT thanh toán - Bước 4: Tạo hạch toán",
          "body": {
            "username": "11111",
            "password": "11111"
          }
        },
        {
          "name": "TBP KTTT (22222)",
          "description": "Login TBP KTTT - Bước 5: Sửa/duyệt hạch toán",
          "body": {
            "username": "22222",
            "password": "22222"
          }
        },
        {
          "name": "Kế toán trưởng (33333)",
          "description": "Login KT trưởng - Bước 6: Duyệt cuối",
          "body": {
            "username": "33333",
            "password": "33333"
          }
        }
      ]
    },
    {
      "name": "Tạo phiếu đề nghị thanh toán - TEST TÍNH TIỀN",
      "method": "POST",
      "endpoint": "/api/payment-request",
      "description": "## TEST: Tính toán giá tiền đúng\n\n**Công thức tính**:\n- amount = quantity * price * (1 + tax/100)\n\n**Test Case 1**: 10 * 50,000 * 1.1 = 550,000\n**Test Case 2**: 20 * 5,000 * 1.1 = 110,000\n**Test Case 3**: 1 * 10,000,000 * 1.1 = 11,000,000\n\n**Tổng tiền**: 11,660,000",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "date": "2025-12-16",
        "has_advance": false,
        "requester_id": "3d9caa7b-52f0-e711-10da-00155d0a0504",
        "workplace_type": 1,
        "workplace_id": "e92cf911-b543-4638-b996-2c4441ca0480",
        "jar_id": "a9656a3d-c43a-4fe9-8fe6-bcfc060de6cd",
        "content": "TEST: Thanh toán thiết bị văn phòng - Kiểm tra tính tiền",
        "payment_type": "cash",
        "previous_payments": 0,
        "payment_details": [
          {
            "description": "Giấy A4 - TEST: 10 x 50,000 x 1.1 = 550,000",
            "unit_id": "4ccc730d-3dd2-441a-b6b6-0eff23d9c16b",
            "quantity": 10,
            "price": 50000,
            "tax": 10,
            "amount": 550000
          },
          {
            "description": "Bút bi - TEST: 20 x 5,000 x 1.1 = 110,000",
            "unit_id": "79f97729-fbe2-4492-bacf-68a0809321b5",
            "quantity": 20,
            "price": 5000,
            "tax": 10,
            "amount": 110000
          },
          {
            "description": "Laptop - TEST: 1 x 10,000,000 x 1.1 = 11,000,000",
            "unit_id": "c3061db2-a12c-46bb-9cf4-7413d5695e96",
            "quantity": 1,
            "price": 10000000,
            "tax": 10,
            "amount": 11000000
          }
        ],
        "payment_documents": [
          {
            "type_document_id": "7835a8dc-707a-45d0-a006-4cbb9002c568",
            "ref_id": [
              "11111111-1111-1111-1111-111111111111",
              "22222222-2222-2222-2222-222222222222"
            ],
            "ref_code": ["REF001", "REF002"]
          }
        ],
        "file_ids": [
          "e41e24c6-215e-43d5-83bf-94cba481daa2",
          "23b5c8b4-12f5-4189-94ed-101a43b16ba5"
        ]
      },
      "templates": [
        {
          "name": "LỌ TÀI SẢN - TEST Luồng KT Tài sản",
          "description": "Test luồng: Bước 2 do KT Tài sản duyệt",
          "body": {
            "date": "2025-12-16",
            "has_advance": false,
            "requester_id": "3d9caa7b-52f0-e711-10da-00155d0a0504",
            "workplace_type": 1,
            "workplace_id": "e92cf911-b543-4638-b996-2c4441ca0480",
            "jar_id": "a9656a3d-c43a-4fe9-8fe6-bcfc060de6cd",
            "content": "LỌ TÀI SẢN - Mua máy tính",
            "payment_type": "cash",
            "payment_details": [
              {
                "description": "Laptop Dell - 2 x 15,000,000 x 1.1 = 33,000,000",
                "unit_id": "4ccc730d-3dd2-441a-b6b6-0eff23d9c16b",
                "quantity": 2,
                "price": 15000000,
                "tax": 10,
                "amount": 33000000
              }
            ],
            "payment_documents": [
              {
                "type_document_id": "7835a8dc-707a-45d0-a006-4cbb9002c568",
                "ref_id": ["11111111-1111-1111-1111-111111111111"],
                "ref_code": ["REF-TS001"]
              }
            ],
            "file_ids": ["e41e24c6-215e-43d5-83bf-94cba481daa2"]
          }
        },
        {
          "name": "LỌ HÀNG HÓA - TEST Luồng KT Hàng hóa",
          "description": "Test luồng: Bước 2 do KT Hàng hóa duyệt",
          "body": {
            "date": "2025-12-16",
            "has_advance": false,
            "requester_id": "3d9caa7b-52f0-e711-10da-00155d0a0504",
            "workplace_type": 1,
            "workplace_id": "e92cf911-b543-4638-b996-2c4441ca0480",
            "jar_id": "7ce3b31a-ba53-4fd3-a565-3ddbce1bb03b",
            "content": "LỌ HÀNG HÓA - Nhập hàng",
            "payment_type": "bank_transfer",
            "disburser_id": "06be8c33-bf86-4b9e-b716-1fff27db53e5",
            "disburser_name": "Công ty TNHH Cung cấp văn phòng phẩm",
            "disburser_bank_account_number": "0123456789",
            "disburser_bank_account_name": "CTY TNHH VPP",
            "disburser_bank_name": "Vietcombank",
            "payment_details": [
              {
                "description": "Giấy in A4 - 100 x 25,000 x 1.08 = 2,700,000",
                "unit_id": "79f97729-fbe2-4492-bacf-68a0809321b5",
                "quantity": 100,
                "price": 25000,
                "tax": 8,
                "amount": 2700000
              },
              {
                "description": "Bút bi - 200 x 3,000 x 1.08 = 648,000",
                "unit_id": "c3061db2-a12c-46bb-9cf4-7413d5695e96",
                "quantity": 200,
                "price": 3000,
                "tax": 8,
                "amount": 648000
              }
            ],
            "payment_documents": [
              {
                "type_document_id": "a13deb11-8acf-4076-aea2-ca98b4fad403",
                "ref_id": ["44444444-4444-4444-4444-444444444444"],
                "ref_code": ["REF-HH001"]
              }
            ],
            "file_ids": ["46077b44-248a-4dc6-8bcd-4e5594adb92f"]
          }
        },
        {
          "name": "LỌ KHÁC - TEST Luồng KT Thuế",
          "description": "Test luồng: Bước 2 do KT Thuế duyệt",
          "body": {
            "date": "2025-12-16",
            "has_advance": false,
            "requester_id": "3d9caa7b-52f0-e711-10da-00155d0a0504",
            "workplace_type": 1,
            "workplace_id": "e92cf911-b543-4638-b996-2c4441ca0480",
            "jar_id": "251af1ac-b48c-4cda-a03c-ac2e91d762dd",
            "content": "LỌ KHÁC - Chi phí văn phòng",
            "payment_type": "cash",
            "payment_details": [
              {
                "description": "Tiền điện - 1 x 2,000,000 x 1.1 = 2,200,000",
                "unit_id": "5c970aad-63d2-4032-beb9-84a723dc89a7",
                "quantity": 1,
                "price": 2000000,
                "tax": 10,
                "amount": 2200000
              },
              {
                "description": "Tiền nước - 1 x 500,000 x 1.1 = 550,000",
                "unit_id": "5e97508e-24ed-44a4-b967-7869135043cc",
                "quantity": 1,
                "price": 500000,
                "tax": 10,
                "amount": 550000
              }
            ],
            "file_ids": ["50acf336-e414-42bd-aba0-ec0ed13eb71a"]
          }
        },
        {
          "name": "TEST TÍNH TIỀN SAI",
          "description": "Test case: Amount tính sai, hệ thống phải reject",
          "body": {
            "date": "2025-12-16",
            "has_advance": false,
            "requester_id": "3d9caa7b-52f0-e711-10da-00155d0a0504",
            "workplace_type": 1,
            "workplace_id": "e92cf911-b543-4638-b996-2c4441ca0480",
            "jar_id": "a9656a3d-c43a-4fe9-8fe6-bcfc060de6cd",
            "content": "TEST: Số tiền tính SAI - Phải bị reject",
            "payment_type": "cash",
            "payment_details": [
              {
                "description": "TÍNH SAI: 10 x 50,000 x 1.1 = 550,000 NHƯNG nhập 500,000",
                "unit_id": "4ccc730d-3dd2-441a-b6b6-0eff23d9c16b",
                "quantity": 10,
                "price": 50000,
                "tax": 10,
                "amount": 500000
              }
            ]
          }
        }
      ]
    },
    {
      "name": "Lấy chi tiết phiếu",
      "method": "GET",
      "endpoint": "/api/payment-request/detail/{id}",
      "description": "## Xem chi tiết phiếu và VERIFY tính tiền\n\n**Kiểm tra**:\n1. Tổng tiền từng dòng = quantity * price * (1 + tax/100)\n2. Tổng tiền toàn phiếu = sum(amount)\n3. Trạng thái duyệt hiện tại",
      "headers": {
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      }
    },
    {
      "name": "BƯỚC 1: Trưởng bộ phận duyệt",
      "method": "PUT",
      "endpoint": "/api/payment-request/status/{id}",
      "description": "## Bước 1: Trưởng bộ phận duyệt\nUser: 55555/55555\n\n**Sau khi duyệt**: Phiếu chuyển sang bước 2 (phụ thuộc loại lọ)",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "status": "approved"
      },
      "templates": [
        {
          "name": "Duyệt",
          "description": "Trưởng BP duyệt phiếu",
          "body": {
            "status": "approved"
          }
        },
        {
          "name": "Từ chối",
          "description": "Trưởng BP từ chối",
          "body": {
            "status": "rejected",
            "reason": "Thiếu chứng từ đính kèm hoặc thông tin không đầy đủ"
          }
        }
      ]
    },
    {
      "name": "BƯỚC 2A: KT Tài sản - Sửa chứng từ đính kèm",
      "method": "PUT",
      "endpoint": "/api/payment-request/documents/{id}",
      "description": "## KT Tài sản sửa chứng từ TRƯỚC KHI duyệt\nUser: 0025/0001\n\n**Chỉ áp dụng**: Nếu phiếu thuộc LỌ TÀI SẢN\n\n**Lưu ý**: ids là mảng ID của payment_documents đã tạo",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": [
        {
          "ids": [
            "f595aed4-29d4-4074-8684-aac1f073330f",
            "ee34fa3e-ad39-4ca2-8e05-3c81ddf46155"
          ],
          "type_document_id": "7835a8dc-707a-45d0-a006-4cbb9002c568",
          "ref_id": [
            "11111111-1111-1111-1111-111111111111",
            "22222222-2222-2222-2222-222222222222",
            "33333333-3333-3333-3333-333333333333"
          ],
          "ref_code": ["REF001", "REF002", "REF003"]
        },
        {
          "ids": ["49bac044-3502-422d-b951-3f59d0224ac0"],
          "type_document_id": "508f05bc-7dcb-4d03-a05a-29fce3ea9402",
          "ref_id": [
            "44444444-4444-4444-4444-444444444444",
            "55555555-5555-5555-5555-555555555555"
          ],
          "ref_code": ["REF004", "REF005"]
        }
      ]
    },
    {
      "name": "BƯỚC 2A: KT Tài sản - Duyệt",
      "method": "PUT",
      "endpoint": "/api/payment-request/status/{id}",
      "description": "## Bước 2: KT Tài sản duyệt\nUser: 0025/0001\n\n**Chỉ áp dụng**: Nếu phiếu thuộc LỌ TÀI SẢN (a9656a3d-c43a-4fe9-8fe6-bcfc060de6cd)",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "status": "approved"
      }
    },
    {
      "name": "BƯỚC 2B: KT Hàng hóa - Sửa chứng từ đính kèm",
      "method": "PUT",
      "endpoint": "/api/payment-request/documents/{id}",
      "description": "## KT Hàng hóa sửa chứng từ TRƯỚC KHI duyệt\nUser: 0091/0091\n\n**Chỉ áp dụng**: Nếu phiếu thuộc LỌ HÀNG HÓA",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": [
        {
          "ids": ["f595aed4-29d4-4074-8684-aac1f073330f"],
          "type_document_id": "a13deb11-8acf-4076-aea2-ca98b4fad403",
          "ref_id": ["44444444-4444-4444-4444-444444444444"],
          "ref_code": ["REF-HH001"]
        }
      ]
    },
    {
      "name": "BƯỚC 2B: KT Hàng hóa - Duyệt",
      "method": "PUT",
      "endpoint": "/api/payment-request/status/{id}",
      "description": "## Bước 2: KT Hàng hóa duyệt\nUser: 0091/0091\n\n**Chỉ áp dụng**: Nếu phiếu thuộc LỌ HÀNG HÓA (7ce3b31a-ba53-4fd3-a565-3ddbce1bb03b)",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "status": "approved"
      }
    },
    {
      "name": "BƯỚC 2C/3: KT Thuế - Tạo hóa đơn",
      "method": "PUT",
      "endpoint": "/api/payment-request/invoices/{id}",
      "description": "## KT Thuế tạo hóa đơn\nUser: 44444/44444\n\n**Áp dụng**: \n- Bước 2 nếu phiếu thuộc LỌ KHÁC\n- Bước 3 nếu phiếu thuộc LỌ TÀI SẢN hoặc HÀNG HÓA",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": [
        {
          "code": "HD-001",
          "date": "2025-12-16",
          "company_id": "9e2ba481-7040-404a-9da0-d612d28303f5",
          "file_id": "e41e24c6-215e-43d5-83bf-94cba481daa2",
          "place": "Công ty VTCODE",
          "amount": "11660000"
        },
        {
          "code": "HD-002",
          "date": "2025-12-16",
          "company_id": "9e2ba481-7040-404a-9da0-d612d28303f5",
          "file_id": "23b5c8b4-12f5-4189-94ed-101a43b16ba5",
          "place": "Công ty ABC",
          "amount": "5000000"
        }
      ]
    },
    {
      "name": "BƯỚC 2C/3: KT Thuế - Tạo hợp đồng",
      "method": "PUT",
      "endpoint": "/api/payment-request/contracts/{id}",
      "description": "## KT Thuế tạo hợp đồng (tùy chọn)\nUser: 44444/44444",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": [
        {
          "code": "HĐ-001",
          "date": "2025-12-01",
          "company_id": "9e2ba481-7040-404a-9da0-d612d28303f5",
          "file_id": "46077b44-248a-4dc6-8bcd-4e5594adb92f",
          "place": "Trụ sở chính",
          "amount": "50000000"
        }
      ]
    },
    {
      "name": "BƯỚC 2C/3: KT Thuế - Duyệt",
      "method": "PUT",
      "endpoint": "/api/payment-request/status/{id}",
      "description": "## KT Thuế duyệt\nUser: 44444/44444\n\n**Sau khi duyệt**: Phiếu chuyển sang Bước 4 (KT Thanh toán)",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "status": "approved"
      }
    },
    {
      "name": "BƯỚC 4: KT Thanh toán - Tạo hạch toán (QUAN TRỌNG)",
      "method": "POST",
      "endpoint": "/api/payment-request/payment-approval/bulk/{id}",
      "description": "## KT Thanh toán TẠO HẠCH TOÁN (BẮT BUỘC)\nUser: 11111/11111\n\n**QUAN TRỌNG**: Phải tạo hạch toán trước khi duyệt!\n\n**Jar Category theo loại lọ**:\n- Lọ tài sản: 69f31527-ba0d-499e-838d-f775c3f37690\n- Lọ hàng hóa: 8e8c4e1a-6605-4652-b81c-945feab01392\n- Lọ khác: 72e8b13a-d21a-4770-b50e-0bb9771df48d\n\n**TEST Tính toán**:\n- amount trong items = quantity * price * (1 + tax/100)\n- Phải khớp với payment_details",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "jar_category_id": "69f31527-ba0d-499e-838d-f775c3f37690",
        "items": [
          {
            "debit_account_id": "4ffd48e4-2f4f-4a6c-9687-300b7eb9b482",
            "credit_account_id": "ddb52d80-84d9-47bf-aecc-a13578d1741c",
            "debit_disburser_type": "bank_account",
            "credit_disburser_type": "bank_account",
            "debit_disburser_id": "74eb3886-f8eb-4e92-963a-3c6efaf54cf4",
            "credit_disburser_id": "8c367d7a-229e-4a8d-918e-c1975650e160",
            "unit_id": "4ccc730d-3dd2-441a-b6b6-0eff23d9c16b",
            "quantity": 10,
            "price": 50000,
            "tax": 10,
            "description": "Hạch toán: Giấy A4 - 10 x 50,000 x 1.1 = 550,000",
            "expense_code": "BTMAYIN"
          },
          {
            "debit_account_id": "f65016bc-e66f-4d0d-b14b-041c799e8675",
            "credit_account_id": "0762acc1-bf60-48a5-8e62-e9b0ccf39e03",
            "debit_disburser_type": "bank_account",
            "credit_disburser_type": "bank_account",
            "debit_disburser_id": "0f43bbe8-c264-405e-a8a7-d05fb88865c3",
            "credit_disburser_id": "4aa7a8be-48de-473b-9953-f16372f70459",
            "unit_id": "c3061db2-a12c-46bb-9cf4-7413d5695e96",
            "quantity": 1,
            "price": 10000000,
            "tax": 10,
            "description": "Hạch toán: Laptop - 1 x 10,000,000 x 1.1 = 11,000,000",
            "expense_code": "BTRIIT"
          }
        ]
      },
      "templates": [
        {
          "name": "Hạch toán - Lọ Tài sản",
          "description": "Tạo hạch toán cho lọ tài sản",
          "body": {
            "jar_category_id": "69f31527-ba0d-499e-838d-f775c3f37690",
            "items": [
              {
                "debit_account_id": "4ffd48e4-2f4f-4a6c-9687-300b7eb9b482",
                "credit_account_id": "ddb52d80-84d9-47bf-aecc-a13578d1741c",
                "debit_disburser_type": "bank_account",
                "credit_disburser_type": "bank_account",
                "debit_disburser_id": "74eb3886-f8eb-4e92-963a-3c6efaf54cf4",
                "credit_disburser_id": "8c367d7a-229e-4a8d-918e-c1975650e160",
                "unit_id": "4ccc730d-3dd2-441a-b6b6-0eff23d9c16b",
                "quantity": 2,
                "price": 15000000,
                "tax": 10,
                "description": "Mua laptop Dell - 2 x 15M x 1.1 = 33M",
                "expense_code": "BTRIIT"
              }
            ]
          }
        },
        {
          "name": "Hạch toán - Lọ Hàng hóa",
          "description": "Tạo hạch toán cho lọ hàng hóa",
          "body": {
            "jar_category_id": "8e8c4e1a-6605-4652-b81c-945feab01392",
            "items": [
              {
                "debit_account_id": "f65016bc-e66f-4d0d-b14b-041c799e8675",
                "credit_account_id": "0762acc1-bf60-48a5-8e62-e9b0ccf39e03",
                "debit_disburser_type": "bank_account",
                "credit_disburser_type": "bank_account",
                "debit_disburser_id": "a8eb8907-17bb-460a-9380-2f9982212540",
                "credit_disburser_id": "c3a51ba7-7095-4d2d-9781-f8431bc11d96",
                "unit_id": "79f97729-fbe2-4492-bacf-68a0809321b5",
                "quantity": 100,
                "price": 25000,
                "tax": 8,
                "description": "Giấy A4 - 100 x 25,000 x 1.08 = 2,700,000",
                "expense_code": "CDC"
              }
            ]
          }
        },
        {
          "name": "Hạch toán - Lọ Khác",
          "description": "Tạo hạch toán cho lọ khác",
          "body": {
            "jar_category_id": "72e8b13a-d21a-4770-b50e-0bb9771df48d",
            "items": [
              {
                "debit_account_id": "074c2ec5-e7c1-478d-924b-82b2418c6e20",
                "credit_account_id": "0435f67c-4d11-4fb0-9411-0452e4f8dffd",
                "debit_disburser_type": "bank_account",
                "credit_disburser_type": "bank_account",
                "debit_disburser_id": "89a735f5-a6fb-4d9c-9d86-1c2fd7b5a1be",
                "credit_disburser_id": "08fe1c29-4b17-4764-b5c5-68394836f73a",
                "unit_id": "5c970aad-63d2-4032-beb9-84a723dc89a7",
                "quantity": 1,
                "price": 2000000,
                "tax": 10,
                "description": "Tiền điện - 1 x 2,000,000 x 1.1 = 2,200,000",
                "expense_code": "DIEN"
              }
            ]
          }
        }
      ]
    },
    {
      "name": "BƯỚC 4: KT Thanh toán - Duyệt",
      "method": "PUT",
      "endpoint": "/api/payment-request/status/{id}",
      "description": "## Bước 4: KT Thanh toán duyệt\nUser: 11111/11111\n\n**QUAN TRỌNG**: Chỉ duyệt được SAU KHI đã tạo hạch toán!\n\n**Lỗi nếu chưa tạo**: 'Hạch toán phải được tạo trước khi duyệt ở bước này'",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "status": "approved"
      }
    },
    {
      "name": "BƯỚC 5: TBP KTTT - Sửa hạch toán (nếu cần)",
      "method": "PUT",
      "endpoint": "/api/payment-request/payment-approval/bulk-update/{id}",
      "description": "## TBP KTTT sửa hạch toán (nếu có sai sót)\nUser: 22222/22222\n\n**Lưu ý**: Có thể sửa hoặc bỏ qua, duyệt luôn",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "jar_category_id": "69f31527-ba0d-499e-838d-f775c3f37690",
        "items": [
          {
            "debit_account_id": "4ffd48e4-2f4f-4a6c-9687-300b7eb9b482",
            "credit_account_id": "ddb52d80-84d9-47bf-aecc-a13578d1741c",
            "debit_disburser_type": "bank_account",
            "credit_disburser_type": "bank_account",
            "debit_disburser_id": "74eb3886-f8eb-4e92-963a-3c6efaf54cf4",
            "credit_disburser_id": "8c367d7a-229e-4a8d-918e-c1975650e160",
            "unit_id": "4ccc730d-3dd2-441a-b6b6-0eff23d9c16b",
            "quantity": 10,
            "price": 50000,
            "tax": 10,
            "description": "CORRECTED: Giấy A4",
            "expense_code": "BTMAYIN"
          }
        ]
      }
    },
    {
      "name": "BƯỚC 5: TBP KTTT - Duyệt",
      "method": "PUT",
      "endpoint": "/api/payment-request/status/{id}",
      "description": "## Bước 5: TBP KTTT duyệt\nUser: 22222/22222",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "status": "approved"
      }
    },
    {
      "name": "BƯỚC 6: Kế toán trưởng - Sửa hạch toán (nếu cần)",
      "method": "PUT",
      "endpoint": "/api/payment-request/{id}/accounting",
      "description": "## Kế toán trưởng sửa hạch toán (nếu có sai sót)\nUser: 33333/33333",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "jar_category_id": "69f31527-ba0d-499e-838d-f775c3f37690",
        "items": [
          {
            "debit_account_id": "4ffd48e4-2f4f-4a6c-9687-300b7eb9b482",
            "credit_account_id": "ddb52d80-84d9-47bf-aecc-a13578d1741c",
            "debit_disburser_type": "bank_account",
            "credit_disburser_type": "bank_account",
            "debit_disburser_id": "74eb3886-f8eb-4e92-963a-3c6efaf54cf4",
            "credit_disburser_id": "8c367d7a-229e-4a8d-918e-c1975650e160",
            "unit_id": "4ccc730d-3dd2-441a-b6b6-0eff23d9c16b",
            "quantity": 10,
            "price": 50000,
            "tax": 10,
            "description": "FINAL APPROVED: Giấy A4",
            "expense_code": "BTMAYIN"
          }
        ]
      }
    },
    {
      "name": "BƯỚC 6: Kế toán trưởng - Duyệt CUỐI CÙNG",
      "method": "PUT",
      "endpoint": "/api/payment-request/status/{id}",
      "description": "## Bước 6: Kế toán trưởng duyệt CUỐI CÙNG\nUser: 33333/33333\n\n**KẾT QUẢ**:\n- Phiếu được duyệt hoàn tất\n- Tự động tạo lịch chi\n\n**TEST**: Kiểm tra tổng tiền cuối cùng có đúng không",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "status": "approved",
        "disbursement_date": "2025-12-20"
      },
      "templates": [
        {
          "name": "Duyệt có ngày chi",
          "description": "KT trưởng duyệt và chọn ngày chi",
          "body": {
            "status": "approved",
            "disbursement_date": "2025-12-20"
          }
        },
        {
          "name": "Từ chối",
          "description": "KT trưởng từ chối phiếu",
          "body": {
            "status": "rejected",
            "reason": "Hạch toán chưa chính xác"
          }
        }
      ]
    },
    {
      "name": "Cập nhật phiếu",
      "method": "PUT",
      "endpoint": "/api/payment-request/{id}",
      "description": "## Sửa phiếu (chỉ khi chưa vào quy trình duyệt)\n\n**Lưu ý**: Không thể sửa khi đang duyệt",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "date": "2025-12-16",
        "has_advance": false,
        "requester_id": "3d9caa7b-52f0-e711-10da-00155d0a0504",
        "workplace_type": 1,
        "workplace_id": "e92cf911-b543-4638-b996-2c4441ca0480",
        "jar_id": "a9656a3d-c43a-4fe9-8fe6-bcfc060de6cd",
        "content": "NỘI DUNG ĐÃ CẬP NHẬT",
        "payment_type": "cash",
        "payment_details": [
          {
            "id": "existing-detail-id",
            "description": "UPDATED: Giấy A4",
            "unit_id": "4ccc730d-3dd2-441a-b6b6-0eff23d9c16b",
            "quantity": 15,
            "price": 50000,
            "tax": 10,
            "amount": 825000
          }
        ]
      }
    },
    {
      "name": "Thêm comment",
      "method": "POST",
      "endpoint": "/api/payment-request/{id}/comments",
      "description": "## Thêm comment trao đổi",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "content": "Vui lòng bổ sung chứng từ đính kèm",
        "parent_id": null
      }
    },
    {
      "name": "Lấy danh sách phiếu",
      "method": "GET",
      "endpoint": "/api/payment-request",
      "description": "## Lấy danh sách phiếu (phân trang)\n\n**TEST**: Kiểm tra total_final_sum có đúng không",
      "headers": {
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      }
    },
    {
      "name": "In phiếu PDF",
      "method": "GET",
      "endpoint": "/api/payment-request/print/{id}",
      "description": "## In phiếu ra PDF",
      "headers": {
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      }
    },
     {
      "name": "Lấy danh sách Jar (Lọ ngân sách)",
      "method": "GET",
      "endpoint": "/api/jars",
      "description": "## Lấy danh sách lọ ngân sách\n\n## Lọ test theo loại\n- **Lọ tài sản**: a9656a3d-c43a-4fe9-8fe6-bcfc060de6cd → Bước 2: KT tài sản duyệt\n- **Lọ hàng hóa**: 7ce3b31a-ba53-4fd3-a565-3ddbce1bb03b → Bước 2: KT hàng hóa duyệt\n- **Lọ khác**: 251af1ac-b48c-4cda-a03c-ac2e91d762dd → Bước 2: KT thuế duyệt",
      "headers": {
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      }
    },
    {
      "name": "Lấy danh sách đơn vị tính",
      "method": "GET",
      "endpoint": "/api/units",
      "description": "## Lấy danh sách đơn vị tính\nDùng cho payment_details",
      "headers": {
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      }
    }
  ],
  "baseUrl": "http://localhost:3000",
  "metadata": {
    "name": "Payment Request API Tests - FULL WORKFLOW",
    "version": "2.0.0",
    "description": "Test collection đầy đủ cho Phiếu đề nghị thanh toán - Bao gồm test tính tiền và luồng duyệt theo loại lọ",
    "created": "2025-12-16",
    "author": "Accounting System Team",
    "test_scenarios": {
      "price_calculation": "Test tính toán: amount = quantity * price * (1 + tax/100)",
      "approval_workflow_asset_jar": "Luồng lọ tài sản: BP → KT Tài sản → KT Thuế → KT TT → TBP KTTT → KT Trưởng",
      "approval_workflow_goods_jar": "Luồng lọ hàng hóa: BP → KT Hàng hóa → KT Thuế → KT TT → TBP KTTT → KT Trưởng",
      "approval_workflow_other_jar": "Luồng lọ khác: BP → KT Thuế → KT TT → TBP KTTT → KT Trưởng",
      "accounting_entries": "Test hạch toán: quantity, price, tax phải khớp với payment_details"
    }
  }
}
