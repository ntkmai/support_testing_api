{
  "requests": [
    {
      "name": "Danh sách phiếu thanh toán",
      "method": "GET",
      "endpoint": "/payment-request?page=1&limit=20&exclude_advance=true",
      "description": "## Mục đích\nLấy danh sách phiếu đề nghị thanh toán (KHÔNG bao gồm tạm ứng)\n\n## Query Parameters\n- page: Trang hiện tại (mặc định: 1)\n- limit: Số bản ghi/trang (mặc định: 20)\n- exclude_advance: true (loại bỏ phiếu tạm ứng)\n- status: Filter theo trạng thái (optional)\n- only_my_turn: true = chỉ lấy phiếu chờ mình duyệt (optional)\n\n## Response mẫu\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"uuid\",\n      \"code\": \"DNTT-LO.TS01-15012025\",\n      \"jar_name\": \"Lọ Tài sản\",\n      \"requester_name\": \"Nguyen Van A\",\n      \"workplace_name\": \"Phòng IT\",\n      \"total_amount\": 5000000,\n      \"status\": \"pending\",\n      \"current_step\": 1,\n      \"current_approver\": \"Trưởng bộ phận\",\n      \"created_at\": \"2025-01-15T10:00:00Z\"\n    }\n  ],\n  \"total\": 25,\n  \"page\": 1,\n  \"limit\": 20\n}\n```",
      "headers": {
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      }
    },
    {
      "name": "Danh sách chờ duyệt",
      "method": "GET",
      "endpoint": "/payment-request?only_my_turn=true&exclude_advance=true&page=1&limit=20",
      "description": "## Mục đích\nLấy danh sách phiếu chờ duyệt của mình\n\n## Query Parameters\n- only_my_turn: true (chỉ lấy phiếu đến lượt mình)\n- exclude_advance: true (loại bỏ tạm ứng)\n\n## Lưu ý\nAPI tự động lọc theo role của user",
      "headers": {
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      }
    },
    {
      "name": "Chi tiết phiếu thanh toán",
      "method": "GET",
      "endpoint": "/payment-request/detail/:id",
      "description": "## Mục đích\nLấy thông tin chi tiết phiếu thanh toán\n\n## Response mẫu\n```json\n{\n  \"id\": \"uuid\",\n  \"code\": \"DNTT-LO.TS01-15012025\",\n  \"jar\": {\n    \"id\": \"uuid\",\n    \"name\": \"Lọ Tài sản\"\n  },\n  \"jar_category\": {\n    \"id\": \"uuid\",\n    \"code\": \"TS01\",\n    \"name\": \"Tài sản cố định\"\n  },\n  \"requester\": {\n    \"id\": \"uuid\",\n    \"name\": \"Nguyen Van A\"\n  },\n  \"workplace\": {\n    \"id\": \"uuid\",\n    \"name\": \"Phòng IT\"\n  },\n  \"disburser\": {\n    \"id\": \"uuid\",\n    \"name\": \"Nguyen Van A\",\n    \"bank_account_name\": \"NGUYEN VAN A\",\n    \"bank_account_number\": \"123456789\",\n    \"bank_name\": \"Vietcombank\"\n  },\n  \"payment_details\": [\n    {\n      \"id\": \"uuid\",\n      \"content\": \"Mua laptop Dell\",\n      \"unit_name\": \"Cái\",\n      \"quantity\": 2,\n      \"price\": \"22000000.00\",\n      \"tax\": \"10\",\n      \"total_after_tax\": \"48400000.00\"\n    }\n  ],\n  \"total_final\": \"48400000.00\",\n  \"status\": \"pending\",\n  \"current_step\": 1,\n  \"approvals\": [\n    {\n      \"step\": 1,\n      \"role\": \"department_manager\",\n      \"approver_name\": \"Mai Thanh Thuận\",\n      \"status\": \"pending\",\n      \"can_approve_on_mobile\": true\n    },\n    {\n      \"step\": 2,\n      \"role\": \"asset_accountant\",\n      \"status\": \"waiting\",\n      \"can_approve_on_mobile\": false\n    }\n  ]\n}\n```",
      "headers": {
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      }
    },
    {
      "name": "Trưởng bộ phận duyệt (Bước 1)",
      "method": "PUT",
      "endpoint": "/payment-request/status/:id",
      "description": "## Mục đích\nTrưởng bộ phận duyệt/từ chối phiếu thanh toán (BƯỚC 1)\n\n## Quyền\n- User: 55555/55555 (Trưởng bộ phận)\n\n## Request Body\n- action: 'approve' | 'reject'\n- note: Ghi chú (bắt buộc khi reject)\n\n## Kết quả\nChuyển sang bước 2 (KT Tài sản/Hàng hóa)",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "action": "approve",
        "note": ""
      },
      "templates": [
        {
          "name": "Duyệt",
          "description": "Trưởng bộ phận duyệt",
          "body": {
            "action": "approve",
            "note": "Đã kiểm tra và phê duyệt"
          }
        },
        {
          "name": "Từ chối",
          "description": "Trưởng bộ phận từ chối",
          "body": {
            "action": "reject",
            "note": "Nội dung không rõ ràng, vui lòng bổ sung"
          }
        }
      ]
    },
    {
      "name": "TBP KTTT duyệt (Bước 5)",
      "method": "PUT",
      "endpoint": "/payment-request/status/:id",
      "description": "## Mục đích\nTrưởng bộ phận KT Thanh toán duyệt (BƯỚC 5)\n\n## Quyền\n- User: 22222/22222 (TBP KTTT)\n\n## ⚠️ CẢNH BÁO\nKhi duyệt bước này trên mobile, cần hiển thị popup:\n\n\"⚠️ BẠN ĐANG DUYỆT TRÊN MOBILE\n\nKhông thể sửa hạch toán trên mobile.\nVui lòng kiểm tra kỹ trước khi duyệt.\n\n[Hủy]  [Tiếp tục duyệt]\"\n\n## Request Body\n- action: 'approve' | 'reject'\n- note: Ghi chú",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "action": "approve",
        "note": ""
      },
      "templates": [
        {
          "name": "Duyệt",
          "description": "TBP KTTT duyệt",
          "body": {
            "action": "approve",
            "note": "Đã xem xét và phê duyệt"
          }
        },
        {
          "name": "Từ chối",
          "description": "TBP KTTT từ chối",
          "body": {
            "action": "reject",
            "note": "Hạch toán chưa chính xác"
          }
        }
      ]
    },
    {
      "name": "Kế toán trưởng duyệt (Bước 6)",
      "method": "PUT",
      "endpoint": "/payment-request/status/:id",
      "description": "## Mục đích\nKế toán trưởng duyệt - Bước cuối (BƯỚC 6)\n\n## Quyền\n- User: 33333/33333 (Kế toán trưởng)\n\n## ⚠️ CẢNH BÁO\nCần hiển thị popup cảnh báo tương tự bước 5\n\n## Kết quả\nSau khi duyệt xong:\n- Hệ thống TỰ ĐỘNG tạo Lịch chi",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_TOKEN_HERE"
      },
      "body": {
        "action": "approve",
        "note": ""
      },
      "templates": [
        {
          "name": "Duyệt",
          "description": "Kế toán trưởng duyệt",
          "body": {
            "action": "approve",
            "note": "Phê duyệt"
          }
        },
        {
          "name": "Từ chối",
          "description": "Kế toán trưởng từ chối",
          "body": {
            "action": "reject",
            "note": "Cần xem xét lại"
          }
        }
      ]
    }
  ],
  "baseUrl": "http://localhost:3000",
  "metadata": {
    "name": "Phiếu thanh toán API",
    "version": "1.0.0",
    "description": "API quản lý phiếu đề nghị thanh toán\n\n⚠️ QUAN TRỌNG:\n1. KHÔNG bao gồm tạm ứng (dùng exclude_advance=true)\n2. Mobile CHỈ duyệt được bước 1, 5, 6\n3. Bước 5-6 cần cảnh báo khi duyệt trên mobile",
    "test_accounts": [
      {
        "role": "Trưởng bộ phận",
        "username": "55555",
        "password": "55555",
        "step": "Bước 1"
      },
      {
        "role": "TBP KTTT",
        "username": "22222",
        "password": "22222",
        "step": "Bước 5"
      },
      {
        "role": "Kế toán trưởng",
        "username": "33333",
        "password": "33333",
        "step": "Bước 6"
      }
    ]
  }
}
